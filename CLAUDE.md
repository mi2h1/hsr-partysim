# CLAUDE開発ガイド - 崩壊スターレイル パーティーシミュレーター

## 🗾 言語設定
**必ず日本語で会話・コメント・コミットメッセージを書くこと**

## 🚫 重要な制約事項

### 開発環境について
- **開発環境は存在しません** - `npm run dev` などのローカルサーバーコマンドは使用不可
- **テスト実行は不可能** - 動作確認はコード解析とロジック検証のみ
- **実際のブラウザでの動作確認は不可能** - ユーザーがテストを行う前提で開発

### データベース操作
- **直接のデータベースアクセス不可** - SQLクエリの直接実行は不可能
- **データベース構造は既存コードから推測** - API実装やクエリから構造を理解
- **マイグレーションスクリプトは作成のみ** - 実行はユーザーが行う

## 📂 ファイル・リソース管理

### ユーザー提供ファイルの場所
- **画像・資料ファイル**: `/mnt/f/OneDrive/Sandbox/` に配置
- **見つからない場合は必ず上記ディレクトリを確認**
- **画像ファイルは必ずReadツールで内容確認**

## 📁 プロジェクト構造理解

### フレームワーク・技術スタック
- **Next.js 15** - App Router使用
- **TypeScript** - 型安全性重視
- **PostgreSQL/Neon** - クラウドデータベース
- **Bootstrap CSS** - UIフレームワーク
- **Vercel** - デプロイ環境

### 主要ディレクトリ
```
/app/
├── api/                    # APIルート
│   ├── characters/         # キャラクター関連API
│   ├── party/             # パーティー編成API
│   └── upload/            # CSV取り込みAPI
├── characters/            # キャラクター関連ページ
├── party/                 # パーティー編成ページ
└── globals.css            # グローバルスタイル
/lib/
├── db.ts                  # データベース接続
└── csvAnalyzer.ts         # CSV解析ロジック
```

## 🎯 開発時の行動指針

### 1. コード変更時
- **既存コードの詳細読み込み** - 変更前に必ず関連ファイルを読む
- **型定義の整合性確保** - TypeScriptエラーを防ぐ
- **Bootstrap CSS活用** - 既存のスタイリング手法に合わせる
- **エラーハンドリング重視** - try-catch、適切なレスポンス

### 2. データベース関連
- **外部キー制約を考慮** - 削除順序: eidolon_enhancements → buffs_debuffs → skills → characters
- **トランザクション使用** - 複数テーブル操作時は必須
- **クエリの型安全性** - `(result as any).rowCount` などでキャスト

### 3. CSV処理関連
- **構造化ルール遵守** - `CSV_STRUCTURING_RULES.md` の最新ポリシーに従う
- **解析→確認→実装の手順** - 必ず解釈内容をユーザーに確認
- **攻撃行動とバフ効果の区別** - 新ポリシーの適用

## 📝 コミット・プッシュルール

### コミットメッセージ形式
```
動作概要を簡潔に

- 具体的な変更内容1
- 具体的な変更内容2
- 技術的な詳細や解決した問題

🤖 Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>
```

### 自動プッシュ条件
- **作業完了時は必ずプッシュ** - ユーザーからの指示がない限り、作業完了後は自動的にプッシュする
- **機能実装完了時** - 新機能追加後の自動プッシュ
- **バグ修正完了時** - 問題解決後の自動プッシュ
- **レイアウト・UI変更時** - 見た目の変更後の自動プッシュ
- **重要な節目** - 大きな機能追加や構造変更後

## 🔍 よくある問題と対処法

### TypeScriptエラー
- `Property 'rowCount' does not exist` → `(result as any).rowCount`
- 型不整合 → インターフェース定義の確認と修正

### データベースエラー  
- 外部キー制約違反 → 削除順序の見直し
- カラム不存在エラー → 実際のスキーマ構造をクエリから推測

### CSV処理エラー
- 解析失敗 → `CSV_STRUCTURING_RULES.md` の最新ルール確認
- バフ・デバフ抽出漏れ → 攻撃行動とバフ効果の区別ポリシー適用

## 🎮 プロジェクト固有の知識

### キャラクターデータ構造
- **基本情報**: name, element, path, version
- **スキル**: 通常攻撃、戦闘スキル、必殺技、天賦、秘技、追加効果1-3
- **星魂**: 1-6レベル、各レベルで効果追加・強化
- **バフ・デバフ**: スキル種別、効果名、対象、ステータス、数値、継続時間

### ゲームシステム固有仕様

#### 記憶の精霊システム
- **「記憶」運命の固有システム** - 召喚物を扱う特殊な運命
- **完全なキャラクター扱い** - 通常の召喚物と異なり、独立したキャラクターとして機能
- **戦闘配置**: 召喚者の隣に配置され、独自の行動順を持つ
- **ステータス依存**: HP（召喚者最大HP+天賦レベル）、攻撃力・会心率（召喚者ステータス反映）
- **サポート対象**: 味方のサポートスキル・バフの対象になる
- **精霊スキル**: 独自の「精霊スキル」で攻撃・支援を行う
- **速度設定**: 召喚者の天賦レベルによって速度が決定

#### 記憶キャラクター追加データ要件
- **精霊基本情報**: 精霊名、種類、外見データ
- **精霊スキル**: 精霊が使用可能なスキル情報
- **精霊ステータス計算式**: 召喚者依存のステータス算出方法
- **精霊効果**: 「精霊に対する効果」と「精霊が発動する効果」の2種類

### UIデザイン方針
- **カードベースレイアウト** - Bootstrap card component使用
- **レスポンシブデザイン** - モバイルファーストアプローチ
- **視覚的フィードバック** - ローディング、エラー状態の表示
- **アイコン活用** - Bootstrap Icons使用

### パフォーマンス考慮
- **データベースクエリ最適化** - 不要なJOINを避ける
- **フロントエンド状態管理** - useState/useEffectの適切な使用
- **エラー境界** - ユーザーフレンドリーなエラーメッセージ

## 📋 TODOリスト管理

### TodoWriteツールの活用
- **複数ステップのタスク** - 必ずTODOリストを作成
- **リアルタイム更新** - タスク完了時に即座にマーク
- **一つずつ処理** - in_progressは同時に1つまで

### 継続中のタスク
- 既存キャラクターのversion値設定（手動DBアップデート必要）

---

**このガイドは新しいチャット開始時に必読**
- 開発環境なし、テスト不可、コード解析ベースでの開発
- **必ず日本語で会話・レスポンス・コミット**
- 制約の中で最高品質のコード実装を目指す